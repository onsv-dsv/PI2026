<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>
    
            <meta name="viewport" content="width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
            <style>
                #map_9c855c24086115ce7839a9bf9c450e97 {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>

            <style>html, body {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }
            </style>

            <style>#map {
                position:absolute;
                top:0;
                bottom:0;
                right:0;
                left:0;
                }
            </style>

            <script>
                L_NO_TOUCH = false;
                L_DISABLE_3D = false;
            </script>

        
</head>
<body>
    
    
    <style>
      .leaflet-interactive.zs-buffer { pointer-events: none !important; }

      .searchbar-wrap {
        position: fixed; right: 20px; bottom: 140px;
        z-index: 10000; background: rgba(255,255,255,0.95);
        border: 1px solid #e5e7eb;
        padding: 10px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.12);
        font-family: system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;
        display: flex; flex-direction: column; gap: 8px; min-width: 300px; max-width: 92vw;
      }

      .searchbar-header { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
      .searchbar-title { font-weight: 700; font-size: 14px; color: #111827; }
      .toggle-btn { border: 0; border-radius: 8px; padding: 4px 10px; font-weight: 700; cursor: pointer; background: #111827; color: #fff; }
      .tools-body { display: flex; flex-direction: column; gap: 8px; }

      .row-flex { display:flex; gap:8px; align-items:center; }
      .col-flex { display:flex; flex-direction:column; gap:8px; }
      .row-flex input, .col-flex input { border:1px solid #e5e7eb; border-radius:8px; padding:6px 8px; font-size:13px; flex:1; }
      .row-flex button, .col-flex button { border:0; border-radius:8px; padding:6px 10px; font-weight:600; cursor:pointer; }
      .btn-dark  { background:#111827; color:#fff; }
      .btn-gray  { background:#6b7280; color:#fff; }
      .btn-green { background:#065f46; color:#fff; }
      .btn-red   { background:#991b1b; color:#fff; }
      .pill { font-size:12px; padding:4px 8px; border-radius:999px; }
      .dist-on-line { background: rgba(17,24,39,0.85); color: #fff; padding: 2px 6px; border-radius: 6px; font-size: 12px; border: 1px solid rgba(255,255,255,0.2); }

      .searchbar-wrap.collapsed { padding: 8px 10px; }
      .searchbar-wrap.collapsed .tools-body { display: none; }

      @media (max-width: 480px) {
        .searchbar-wrap { right: 12px; bottom: 12px; min-width: 240px; }
      }
    </style>
    
    
    <div style="
        position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
        z-index: 9999; background: rgba(255,255,255,0.9);
        padding: 8px 14px; border-radius: 8px; font-weight: 600;
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;">
        LIMA-HUAURA-HUALMAY
    </div>
    
    
    <div id="legend-box" style="
        position: fixed; bottom: 20px; right: 20px; z-index: 9999;
        background: rgba(255,255,255,0.9); padding: 10px 12px; border-radius: 8px;
        font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
        box-shadow: 0 2px 6px rgba(0,0,0,0.15); line-height: 1.4; min-width: 240px;">
        <div style="font-weight: 600; margin-bottom: 6px;">Leyenda</div>
        <div style="display:flex; align-items:center; gap:8px; margin-bottom:4px;">
            <span style="display:inline-block; width:14px; height:14px; background:#1d4ed8; border-radius:50%;"></span>
            <span>Azul: Nuevas</span>
        </div>
        <div style="display:flex; align-items:center; gap:8px;">
            <span style="display:inline-block; width:14px; height:14px; background:#7dd3fc; border-radius:50%;"></span>
            <span>Celeste: Mantenimiento</span>
        </div>
        <div style="display:flex; align-items:center; gap:8px; margin-top:4px;">
            <span style="display:inline-block; width:14px; height:14px; background:#d90429; border-radius:50%;"></span>
            <span>Rojo: Siniestro fatal</span>
        </div>
    </div>
    
    
            <div class="folium-map" id="map_9c855c24086115ce7839a9bf9c450e97" ></div>
        
    
      <div class="searchbar-wrap" id="zs_tools">
        <div class="searchbar-header">
          <div class="searchbar-title">Herramientas</div>
          <button id="btn_toggle_box" class="toggle-btn" title="Mostrar/Ocultar">‚ØÜ Ocultar</button>
        </div>

        <div class="tools-body">
          <div class="col-flex">
            <input id="q_name" type="text" placeholder="Buscar por nombre">
            <input id="q_code" type="text" placeholder="Buscar por c√≥digo">
          </div>
          <div class="row-flex">
            <button id="btn_search" class="btn-dark">Buscar</button>
            <button id="btn_clear" class="btn-gray">Limpiar</button>
          </div>

          <hr style="border:none;border-top:1px solid #e5e7eb; margin:4px 0;">

          <div class="col-flex" title="Coordenadas en grados decimales">
            <input id="q_x" type="text" placeholder="Longitud Ejem: -77.15435">
            <div class="row-flex">
              <input id="q_y" type="text" placeholder="Latitud Ejem: -15.54648">
              <button id="btn_xy_go" class="btn-green" title="Centrar en coordenadas">üîç</button>
              <button id="btn_xy_clear" class="btn-red"   title="Quitar pin de coordenadas">‚úï</button>
            </div>
          </div>

          <div class="row-flex">
            <button id="btn_measure_toggle" class="btn-dark pill" title="Medir distancia">Medir distancia</button>
            <span id="measure_state" style="font-size:12px; color:#991b1b">Desactivado</span>
          </div>

          <div class="row-flex">
            <button id="btn_open_gmaps" class="btn-dark" title="Abrir esta vista en Google Maps">Abrir en Google Maps</button>
          </div>
        </div>
      </div>
    
</body>
<script>
    
    
            var map_9c855c24086115ce7839a9bf9c450e97 = L.map(
                "map_9c855c24086115ce7839a9bf9c450e97",
                {
                    center: [-11.099740125, -77.60581325],
                    crs: L.CRS.EPSG3857,
                    ...{
  "zoom": 14,
  "zoomControl": true,
  "preferCanvas": false,
}

                }
            );
            L.control.scale().addTo(map_9c855c24086115ce7839a9bf9c450e97);

            

        
    
            var tile_layer_7a478678088da6db3c20b9e65f247c79 = L.tileLayer(
                "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
                {
  "minZoom": 0,
  "maxZoom": 19,
  "maxNativeZoom": 19,
  "noWrap": false,
  "attribution": "\u0026copy; \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors",
  "subdomains": "abc",
  "detectRetina": false,
  "tms": false,
  "opacity": 1,
}

            );
        
    
            tile_layer_7a478678088da6db3c20b9e65f247c79.addTo(map_9c855c24086115ce7839a9bf9c450e97);
        
    
            var feature_group_c44904dfae7c11e72bce3e85c80af6ef = L.featureGroup(
                {
}
            );
        
    
        function geo_json_7f99635a7d56fd04a50712d3b65fb07c_styler(feature) {
            switch(feature.properties.IDDPTO) {
                default:
                    return {"color": "#222222", "fill": true, "fillColor": "#9ca3af", "fillOpacity": 0.3, "opacity": 1.0, "weight": 2.5};
            }
        }

        function geo_json_7f99635a7d56fd04a50712d3b65fb07c_onEachFeature(feature, layer) {

            layer.on({
            });
        };
        var geo_json_7f99635a7d56fd04a50712d3b65fb07c = L.geoJson(null, {
                onEachFeature: geo_json_7f99635a7d56fd04a50712d3b65fb07c_onEachFeature,
            
                style: geo_json_7f99635a7d56fd04a50712d3b65fb07c_styler,
            ...{
}
        });

        function geo_json_7f99635a7d56fd04a50712d3b65fb07c_add (data) {
            geo_json_7f99635a7d56fd04a50712d3b65fb07c
                .addData(data);
        }
            geo_json_7f99635a7d56fd04a50712d3b65fb07c_add({"features": [{"geometry": {"coordinates": [[[[-77.59780861199988, -11.077126978999843], [-77.5966816109999, -11.083368978999943], [-77.59635998599992, -11.085037728999964], [-77.59549223699997, -11.090597603999925], [-77.59486898699993, -11.094724603999964], [-77.59486848599988, -11.095093603999942], [-77.59486736199989, -11.09576172899989], [-77.59537698699995, -11.097267603999967], [-77.59580861199998, -11.098285103999956], [-77.59582411199995, -11.09839097899993], [-77.59604473699994, -11.099904353999932], [-77.59635361199986, -11.100069728999927], [-77.59641361199994, -11.100139228999979], [-77.59664223599992, -11.10040335399998], [-77.59736386199995, -11.101215103999834], [-77.59776073699993, -11.101548978999915], [-77.59850936099997, -11.101855728999965], [-77.59930311199992, -11.102252603999943], [-77.59976311199995, -11.102586353999868], [-77.60011261199992, -11.102783228999897], [-77.60040361099993, -11.102947103999952], [-77.60093086099994, -11.103019478999897], [-77.60142286099989, -11.102847728999905], [-77.60182873699989, -11.102514103999908], [-77.60240598699994, -11.102324728999974], [-77.60271273699993, -11.102284603999863], [-77.60316373699993, -11.102225478999856], [-77.60329898699996, -11.102234353999961], [-77.60338923699999, -11.102360853999926], [-77.60352448699996, -11.102649353999936], [-77.60374998599997, -11.10274872899987], [-77.60388536199997, -11.102766728999939], [-77.60395986099991, -11.102897228999836], [-77.60399361199995, -11.10295610399993], [-77.6040747369999, -11.103334978999897], [-77.60416498599994, -11.103542478999941], [-77.60439948699997, -11.103506353999876], [-77.60502186199994, -11.103172603999951], [-77.6057524869999, -11.102865978999887], [-77.60629373699993, -11.102577353999834], [-77.6067357369999, -11.102432978999957], [-77.6071016119999, -11.102387978999957], [-77.60732198699992, -11.102360853999926], [-77.60770998699996, -11.10228860399991], [-77.60807973699991, -11.102270603999955], [-77.6082329869999, -11.102306728999906], [-77.60826911199996, -11.102622353999891], [-77.60839536199984, -11.103109478999897], [-77.6085938619999, -11.103163603999917], [-77.60893673599998, -11.103127478999966], [-77.60923423599996, -11.102910978999887], [-77.60960411099995, -11.102874978999921], [-77.6100461119999, -11.102865978999887], [-77.61012523699998, -11.102928103999886], [-77.61017236199996, -11.102965103999964], [-77.61019936099996, -11.103325978999976], [-77.61023548599997, -11.10359660399996], [-77.61041586099992, -11.10365072899998], [-77.61074961199995, -11.103623603999893], [-77.61091811199992, -11.103746103999981], [-77.61094811199985, -11.10376797899994], [-77.61116436199995, -11.103912228999945], [-77.61189511199996, -11.103912228999945], [-77.61276111099994, -11.103912228999945], [-77.61359098699995, -11.103840103999971], [-77.61440273699998, -11.103803978999963], [-77.6145741119999, -11.104101728999922], [-77.61492573699996, -11.10468560399994], [-77.61527773699999, -11.10522022899994], [-77.61585498699992, -11.105707103999976], [-77.61736136199988, -11.107114353999975], [-77.61751948699998, -11.107005853999965], [-77.61941598699997, -11.10519922899988], [-77.62341998699998, -11.100855478999904], [-77.62489061199989, -11.099451228999897], [-77.62535161199992, -11.098943353999971], [-77.62448723699998, -11.098014228999943], [-77.62387298599998, -11.0975587289999], [-77.62301261199991, -11.097207228999935], [-77.62281048699998, -11.097121103999939], [-77.62216411099996, -11.096744103999981], [-77.62192773699996, -11.096525353999937], [-77.62180273699994, -11.096356103999938], [-77.62170898699998, -11.096234353999932], [-77.62132436099995, -11.095800728999905], [-77.62082811199991, -11.095376978999866], [-77.6190781119999, -11.094765603999974], [-77.61815823699999, -11.094408228999896], [-77.61756073699996, -11.09378135399993], [-77.61742336199995, -11.093511103999845], [-77.61723073699989, -11.0932866039999], [-77.61650248699993, -11.093034603999854], [-77.61564586199995, -11.092805603999977], [-77.61464623699993, -11.09249097899982], [-77.61362011199992, -11.091977228999951], [-77.61288286199988, -11.090994228999875], [-77.61244598599995, -11.089465103999942], [-77.61162686199998, -11.088564103999886], [-77.61023423699993, -11.087662978999958], [-77.60954298699994, -11.086863228999846], [-77.60930586199993, -11.08536947899995], [-77.60935336199998, -11.081687478999982], [-77.60873573699985, -11.077226728999904], [-77.60773911099989, -11.077081353999972], [-77.60647248699996, -11.077039853999906], [-77.60576648699993, -11.07695672899996], [-77.60514361199989, -11.076894478999975], [-77.60460373699993, -11.076790603999882], [-77.60391848699999, -11.076977478999822], [-77.60304648699992, -11.077288978999945], [-77.60179023699999, -11.077515728999856], [-77.60151023599991, -11.077495728999963], [-77.60058023699997, -11.077345728999887], [-77.59961023699992, -11.076875728999937], [-77.5987299869999, -11.076215728999955], [-77.59817048699989, -11.075505728999815], [-77.59780861199988, -11.077126978999843]]]], "type": "MultiPolygon"}, "properties": {"AREA": 1, "CAPITAL": "HUALMAY", "CODCCPP": "0001", "DEPARTAMEN": "LIMA", "DISTRITO": "HUALMAY", "FUENTE": "INEI", "IDDIST": "150805", "IDDPTO": "15", "IDPROV": "1508", "PROVINCIA": "HUAURA"}, "type": "Feature"}], "type": "FeatureCollection"});

        
    
            geo_json_7f99635a7d56fd04a50712d3b65fb07c.addTo(feature_group_c44904dfae7c11e72bce3e85c80af6ef);
        
    
            feature_group_c44904dfae7c11e72bce3e85c80af6ef.addTo(map_9c855c24086115ce7839a9bf9c450e97);
        
    
            var feature_group_e7f534a8c55174cf4e5a24aa2d32764c = L.featureGroup(
                {
}
            );
        
    
            var circle_45503015b66ac25568ab2924e123df9b = L.circle(
                [-11.103934, -77.616721],
                {"bubblingMouseEvents": true, "className": "zs-buffer", "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 0.5, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 100, "stroke": true, "weight": 2}
            ).addTo(feature_group_e7f534a8c55174cf4e5a24aa2d32764c);
        
    
            var circle_f0dffa10f183abd389579ce56f49957d = L.circle(
                [-11.09862, -77.61245],
                {"bubblingMouseEvents": true, "className": "zs-buffer", "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 0.5, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 100, "stroke": true, "weight": 2}
            ).addTo(feature_group_e7f534a8c55174cf4e5a24aa2d32764c);
        
    
            var circle_f4341d9fbe67da6bb300e1ac4315d847 = L.circle(
                [-11.09965, -77.60663],
                {"bubblingMouseEvents": true, "className": "zs-buffer", "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 0.5, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 100, "stroke": true, "weight": 2}
            ).addTo(feature_group_e7f534a8c55174cf4e5a24aa2d32764c);
        
    
            var circle_e39a3e4a3f69a8b4155b35e905477559 = L.circle(
                [-11.1013, -77.60759],
                {"bubblingMouseEvents": true, "className": "zs-buffer", "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 0.5, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 100, "stroke": true, "weight": 2}
            ).addTo(feature_group_e7f534a8c55174cf4e5a24aa2d32764c);
        
    
            var circle_815c7fed987402fac0378c22210d4d38 = L.circle(
                [-11.095957, -77.603465],
                {"bubblingMouseEvents": true, "className": "zs-buffer", "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 0.5, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 100, "stroke": true, "weight": 2}
            ).addTo(feature_group_e7f534a8c55174cf4e5a24aa2d32764c);
        
    
            var circle_f041d3f5d2323b5feb4a02febf21f72f = L.circle(
                [-11.10154, -77.59812],
                {"bubblingMouseEvents": true, "className": "zs-buffer", "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 0.5, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 100, "stroke": true, "weight": 2}
            ).addTo(feature_group_e7f534a8c55174cf4e5a24aa2d32764c);
        
    
            var circle_d3282010b270e3254450168934d88423 = L.circle(
                [-11.10152, -77.59813],
                {"bubblingMouseEvents": true, "className": "zs-buffer", "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 0.5, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 100, "stroke": true, "weight": 2}
            ).addTo(feature_group_e7f534a8c55174cf4e5a24aa2d32764c);
        
    
            var circle_6f9d68cbef14a1daf6449f1a6ac99d7a = L.circle(
                [-11.0954, -77.6034],
                {"bubblingMouseEvents": true, "className": "zs-buffer", "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 0.5, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 100, "stroke": true, "weight": 2}
            ).addTo(feature_group_e7f534a8c55174cf4e5a24aa2d32764c);
        
    
            feature_group_e7f534a8c55174cf4e5a24aa2d32764c.addTo(map_9c855c24086115ce7839a9bf9c450e97);
        
    
            var feature_group_87eb84a6153bb3a567d0b95d709fb94e = L.featureGroup(
                {
}
            );
        
    
            var circle_marker_ef23df18653eddf7de948f5299d9f947 = L.circleMarker(
                [-11.103934, -77.616721],
                {"bubblingMouseEvents": true, "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 1.0, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 5, "stroke": true, "weight": 2}
            ).addTo(feature_group_87eb84a6153bb3a567d0b95d709fb94e);
        
    
        var popup_1085ac385a970d7ead80bd76555b3a32 = L.popup({
  "maxWidth": 420,
});

        
            
                var html_32644ea251746057bf62677927fd6352 = $(`<div id="html_32644ea251746057bf62677927fd6352" style="width: 100.0%; height: 100.0%;"><b>21006 FLOR DE MARIA DRAGO PERSIVALE / 669 FLOR DE MARIA DRAGO PERSIVALE</b><br>C√≥digo CE: 359065<br>UBIGEO gestor: 150805<br>Latitud: -11.103934<br>Longitud: -77.616721<br>Alumnos: 256<br>Docentes: 23<br>Siniestros: 0</div>`)[0];
                popup_1085ac385a970d7ead80bd76555b3a32.setContent(html_32644ea251746057bf62677927fd6352);
            
        

        circle_marker_ef23df18653eddf7de948f5299d9f947.bindPopup(popup_1085ac385a970d7ead80bd76555b3a32)
        ;

        
    
    
            circle_marker_ef23df18653eddf7de948f5299d9f947.bindTooltip(
                `<div>
                     21006 flor de maria drago persivale / 669 flor de maria drago persivale | 359065
                 </div>`,
                {
  "opacity": 0,
  "sticky": false,
}
            );
        
    
            var circle_marker_18c118e9e8d6f22497e0eadfe2421815 = L.circleMarker(
                [-11.09862, -77.61245],
                {"bubblingMouseEvents": true, "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 1.0, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 5, "stroke": true, "weight": 2}
            ).addTo(feature_group_87eb84a6153bb3a567d0b95d709fb94e);
        
    
        var popup_38015db13eb4de0c46c4a1aefe682a16 = L.popup({
  "maxWidth": 420,
});

        
            
                var html_e79e15572fefb203302c7048680ada9f = $(`<div id="html_e79e15572fefb203302c7048680ada9f" style="width: 100.0%; height: 100.0%;"><b>20329 JOSE CARLOS MARIATEGUI / 673 JOSE CARLOS MARIATEGUI</b><br>C√≥digo CE: 359980<br>UBIGEO gestor: 150805<br>Latitud: -11.09862<br>Longitud: -77.61245<br>Alumnos: 362<br>Docentes: 22<br>Siniestros: 0</div>`)[0];
                popup_38015db13eb4de0c46c4a1aefe682a16.setContent(html_e79e15572fefb203302c7048680ada9f);
            
        

        circle_marker_18c118e9e8d6f22497e0eadfe2421815.bindPopup(popup_38015db13eb4de0c46c4a1aefe682a16)
        ;

        
    
    
            circle_marker_18c118e9e8d6f22497e0eadfe2421815.bindTooltip(
                `<div>
                     20329 jose carlos mariategui / 673 jose carlos mariategui | 359980
                 </div>`,
                {
  "opacity": 0,
  "sticky": false,
}
            );
        
    
            var circle_marker_6a3f68b48568d61461fdb0ae8ae1daf4 = L.circleMarker(
                [-11.09965, -77.60663],
                {"bubblingMouseEvents": true, "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 1.0, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 5, "stroke": true, "weight": 2}
            ).addTo(feature_group_87eb84a6153bb3a567d0b95d709fb94e);
        
    
        var popup_e467ddce843a39683853dd1041795b48 = L.popup({
  "maxWidth": 420,
});

        
            
                var html_5d79c7d21ae4fb312acc1cd2830010dd = $(`<div id="html_5d79c7d21ae4fb312acc1cd2830010dd" style="width: 100.0%; height: 100.0%;"><b>20331 / 656 PASITOS DE JESUS</b><br>C√≥digo CE: 360016<br>UBIGEO gestor: 150805<br>Latitud: -11.09965<br>Longitud: -77.60663<br>Alumnos: 493<br>Docentes: 26<br>Siniestros: 0</div>`)[0];
                popup_e467ddce843a39683853dd1041795b48.setContent(html_5d79c7d21ae4fb312acc1cd2830010dd);
            
        

        circle_marker_6a3f68b48568d61461fdb0ae8ae1daf4.bindPopup(popup_e467ddce843a39683853dd1041795b48)
        ;

        
    
    
            circle_marker_6a3f68b48568d61461fdb0ae8ae1daf4.bindTooltip(
                `<div>
                     20331 / 656 pasitos de jesus | 360016
                 </div>`,
                {
  "opacity": 0,
  "sticky": false,
}
            );
        
    
            var circle_marker_245ee919fd8916f42778f8435e423497 = L.circleMarker(
                [-11.1013, -77.60759],
                {"bubblingMouseEvents": true, "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 1.0, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 5, "stroke": true, "weight": 2}
            ).addTo(feature_group_87eb84a6153bb3a567d0b95d709fb94e);
        
    
        var popup_0572ab9e3dbbd53bd12d2030ffab351c = L.popup({
  "maxWidth": 420,
});

        
            
                var html_ea2de20a808fca732b06d9da9a5854cf = $(`<div id="html_ea2de20a808fca732b06d9da9a5854cf" style="width: 100.0%; height: 100.0%;"><b>20983 JULIO C. TELLO</b><br>C√≥digo CE: 360035<br>UBIGEO gestor: 150805<br>Latitud: -11.1013<br>Longitud: -77.60759<br>Alumnos: 740<br>Docentes: 57<br>Siniestros: 0</div>`)[0];
                popup_0572ab9e3dbbd53bd12d2030ffab351c.setContent(html_ea2de20a808fca732b06d9da9a5854cf);
            
        

        circle_marker_245ee919fd8916f42778f8435e423497.bindPopup(popup_0572ab9e3dbbd53bd12d2030ffab351c)
        ;

        
    
    
            circle_marker_245ee919fd8916f42778f8435e423497.bindTooltip(
                `<div>
                     20983 julio c. tello | 360035
                 </div>`,
                {
  "opacity": 0,
  "sticky": false,
}
            );
        
    
            var circle_marker_0f1918593114f04ed62d7f83088dcf66 = L.circleMarker(
                [-11.095957, -77.603465],
                {"bubblingMouseEvents": true, "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 1.0, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 5, "stroke": true, "weight": 2}
            ).addTo(feature_group_87eb84a6153bb3a567d0b95d709fb94e);
        
    
        var popup_da608c93be604f57ca7c2e012066833e = L.popup({
  "maxWidth": 420,
});

        
            
                var html_73b88158b612a51a8a1acdd0c5d11f37 = $(`<div id="html_73b88158b612a51a8a1acdd0c5d11f37" style="width: 100.0%; height: 100.0%;"><b>SAN JOSE OBRERO</b><br>C√≥digo CE: 360078<br>UBIGEO gestor: 150805<br>Latitud: -11.095957<br>Longitud: -77.603465<br>Alumnos: 269<br>Docentes: 16<br>Siniestros: 0</div>`)[0];
                popup_da608c93be604f57ca7c2e012066833e.setContent(html_73b88158b612a51a8a1acdd0c5d11f37);
            
        

        circle_marker_0f1918593114f04ed62d7f83088dcf66.bindPopup(popup_da608c93be604f57ca7c2e012066833e)
        ;

        
    
    
            circle_marker_0f1918593114f04ed62d7f83088dcf66.bindTooltip(
                `<div>
                     san jose obrero | 360078
                 </div>`,
                {
  "opacity": 0,
  "sticky": false,
}
            );
        
    
            var circle_marker_82f07ca4bb5c6320f8867c7b2802bf36 = L.circleMarker(
                [-11.10154, -77.59812],
                {"bubblingMouseEvents": true, "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 1.0, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 5, "stroke": true, "weight": 2}
            ).addTo(feature_group_87eb84a6153bb3a567d0b95d709fb94e);
        
    
        var popup_a5017be08e4068f2010c4cf43731e885 = L.popup({
  "maxWidth": 420,
});

        
            
                var html_de384b660a88c4070bf429b189e22d9a = $(`<div id="html_de384b660a88c4070bf429b189e22d9a" style="width: 100.0%; height: 100.0%;"><b>SANTA ROSA DE LIMA</b><br>C√≥digo CE: 360101<br>UBIGEO gestor: 150805<br>Latitud: -11.10154<br>Longitud: -77.59812<br>Alumnos: 134<br>Docentes: 9<br>Siniestros: 1</div>`)[0];
                popup_a5017be08e4068f2010c4cf43731e885.setContent(html_de384b660a88c4070bf429b189e22d9a);
            
        

        circle_marker_82f07ca4bb5c6320f8867c7b2802bf36.bindPopup(popup_a5017be08e4068f2010c4cf43731e885)
        ;

        
    
    
            circle_marker_82f07ca4bb5c6320f8867c7b2802bf36.bindTooltip(
                `<div>
                     santa rosa de lima | 360101
                 </div>`,
                {
  "opacity": 0,
  "sticky": false,
}
            );
        
    
            var circle_marker_0ca3c771405e6626d89aacdfb1627e39 = L.circleMarker(
                [-11.10152, -77.59813],
                {"bubblingMouseEvents": true, "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 1.0, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 5, "stroke": true, "weight": 2}
            ).addTo(feature_group_87eb84a6153bb3a567d0b95d709fb94e);
        
    
        var popup_2ffbc31c832c09e639a4a07ecc00f430 = L.popup({
  "maxWidth": 420,
});

        
            
                var html_8f8e61baed953b1816a68ead1842f9df = $(`<div id="html_8f8e61baed953b1816a68ead1842f9df" style="width: 100.0%; height: 100.0%;"><b>SANTA ROSA DE LIMA</b><br>C√≥digo CE: 360120<br>UBIGEO gestor: 150805<br>Latitud: -11.10152<br>Longitud: -77.59813<br>Alumnos: 366<br>Docentes: 21<br>Siniestros: 1</div>`)[0];
                popup_2ffbc31c832c09e639a4a07ecc00f430.setContent(html_8f8e61baed953b1816a68ead1842f9df);
            
        

        circle_marker_0ca3c771405e6626d89aacdfb1627e39.bindPopup(popup_2ffbc31c832c09e639a4a07ecc00f430)
        ;

        
    
    
            circle_marker_0ca3c771405e6626d89aacdfb1627e39.bindTooltip(
                `<div>
                     santa rosa de lima | 360120
                 </div>`,
                {
  "opacity": 0,
  "sticky": false,
}
            );
        
    
            var circle_marker_860cb91fa3401e57c51654250379296b = L.circleMarker(
                [-11.0954, -77.6034],
                {"bubblingMouseEvents": true, "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 1.0, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 5, "stroke": true, "weight": 2}
            ).addTo(feature_group_87eb84a6153bb3a567d0b95d709fb94e);
        
    
        var popup_3d02a1008ce808abd47a34e84b450b70 = L.popup({
  "maxWidth": 420,
});

        
            
                var html_4faf0a2ecbf41f2ecc7646ecea76f2d0 = $(`<div id="html_4faf0a2ecbf41f2ecc7646ecea76f2d0" style="width: 100.0%; height: 100.0%;"><b>LICEO ESPA√ëOL SAN JUAN BAUTISTA</b><br>C√≥digo CE: 602058<br>UBIGEO gestor: 150805<br>Latitud: -11.0954<br>Longitud: -77.6034<br>Alumnos: 598<br>Docentes: 29<br>Siniestros: 0</div>`)[0];
                popup_3d02a1008ce808abd47a34e84b450b70.setContent(html_4faf0a2ecbf41f2ecc7646ecea76f2d0);
            
        

        circle_marker_860cb91fa3401e57c51654250379296b.bindPopup(popup_3d02a1008ce808abd47a34e84b450b70)
        ;

        
    
    
            circle_marker_860cb91fa3401e57c51654250379296b.bindTooltip(
                `<div>
                     liceo espa√±ol san juan bautista | 602058
                 </div>`,
                {
  "opacity": 0,
  "sticky": false,
}
            );
        
    
            feature_group_87eb84a6153bb3a567d0b95d709fb94e.addTo(map_9c855c24086115ce7839a9bf9c450e97);
        
    
            var feature_group_d2fa571668b7ad39f8c1d28f3e727f6e = L.featureGroup(
                {
}
            );
        
    
            var circle_marker_ac8820db042683489b3bf12cc3b130df = L.circleMarker(
                [-11.078665, -77.597574],
                {"bubblingMouseEvents": true, "color": "#d90429", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#d90429", "fillOpacity": 1.0, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 5, "stroke": true, "weight": 2}
            ).addTo(feature_group_d2fa571668b7ad39f8c1d28f3e727f6e);
        
    
        var popup_4c198bdb3d6ffd683a6d8986e64441da = L.popup({
  "maxWidth": 420,
});

        
            
                var html_ace934b920f515115f6c28e5e7eeab24 = $(`<div id="html_ace934b920f515115f6c28e5e7eeab24" style="width: 100.0%; height: 100.0%;"><div style='font-size:12px;'><div style='font-weight:700; margin-bottom:6px;'>Siniestro fatal</div><table style='border-collapse:collapse;'><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>COD_ACCIDE</th><td style='padding:2px 0;'>A-2021-08-271</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>FechaDelAccidente</th><td style='padding:2px 0;'>24/08/2021</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>HoraDelAccidente</th><td style='padding:2px 0;'>23:29</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>ClaseDelAccidente</th><td style='padding:2px 0;'>CHOQUE</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>SecuenciaAccidente</th><td style='padding:2px 0;'>EL VEH√çCULO M3 - CLASE III, √ìMNIBUS DE PLACA DE RODAJE F2W-966,  CIRCULABA POR LA CARRETERA PANAMERICANA NORTE EN SENTIDO DE SUR A NORTE, AL LLEGAR A LA AV. PERALBILLO, IMBADE EL CARRIL CONTRARIO, IMPACTANDO FRONTALMENTE AL VEH√çCULO CATG. L3 - MOTOCICLETA DE PLACA DE RODAJE A5-0088.</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>CantidadDeFallecidos</th><td style='padding:2px 0;'>1</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>CantidadDeLesionados</th><td style='padding:2px 0;'>0</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>Direccion</th><td style='padding:2px 0;'>AV. PERALVILLO CDRA. 31 (EX CARRETERA PANAMERICANA NORTE)</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>LugarReferencia</th><td style='padding:2px 0;'>CENTRO POBLADO PERALVILLO -  HUALMAY</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>y</th><td style='padding:2px 0;'>-11.078665</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>x</th><td style='padding:2px 0;'>-77.597574</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>CondClimatica</th><td style='padding:2px 0;'>DESPEJADO</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>CausaFactorPrincipal</th><td style='padding:2px 0;'>IMPRUDENCIA DEL CONDUCTOR</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>CausaEspecifica</th><td style='padding:2px 0;'>INVASI√ìN DE CARRIL</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>OtraCausa</th><td style='padding:2px 0;'></td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>Observaciones</th><td style='padding:2px 0;'>NINGUNA</td></tr></table></div></div>`)[0];
                popup_4c198bdb3d6ffd683a6d8986e64441da.setContent(html_ace934b920f515115f6c28e5e7eeab24);
            
        

        circle_marker_ac8820db042683489b3bf12cc3b130df.bindPopup(popup_4c198bdb3d6ffd683a6d8986e64441da)
        ;

        
    
    
            var circle_marker_bd1217255c33ab8694d57cda1e3fbf7d = L.circleMarker(
                [-11.10017, -77.59648],
                {"bubblingMouseEvents": true, "color": "#d90429", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#d90429", "fillOpacity": 1.0, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 5, "stroke": true, "weight": 2}
            ).addTo(feature_group_d2fa571668b7ad39f8c1d28f3e727f6e);
        
    
        var popup_932bcb7fdcac7ba73637dad9e54eadc2 = L.popup({
  "maxWidth": 420,
});

        
            
                var html_ec01b284c06b36d8c1027c060e1882b7 = $(`<div id="html_ec01b284c06b36d8c1027c060e1882b7" style="width: 100.0%; height: 100.0%;"><div style='font-size:12px;'><div style='font-weight:700; margin-bottom:6px;'>Siniestro fatal</div><table style='border-collapse:collapse;'><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>COD_ACCIDE</th><td style='padding:2px 0;'>A-2022-06-247</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>FechaDelAccidente</th><td style='padding:2px 0;'>21/06/2022</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>HoraDelAccidente</th><td style='padding:2px 0;'>19:20</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>ClaseDelAccidente</th><td style='padding:2px 0;'>ATROPELLO</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>SecuenciaAccidente</th><td style='padding:2px 0;'>EL PEAT√ìN SE DESPLAZABA POR LA AV. PUQUIO CANO, EN SENTIDO DE OESTE A ESTE, OCUPANDO PARTE DEL CARRIL SUR, AL LLEGAR LA ZONA DEL ACCIDENTE, HACE SU CAMBIO DE DIRECCI√ìN HACIA EL NORTE, INTERPONIENDOSE EN EL EJE DE CIRCULACI√ìN DEL L3 DE PLACA 9311-9D</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>CantidadDeFallecidos</th><td style='padding:2px 0;'>1</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>CantidadDeLesionados</th><td style='padding:2px 0;'>1</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>Direccion</th><td style='padding:2px 0;'>AV. PUQUIO CANO</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>LugarReferencia</th><td style='padding:2px 0;'>CDRA. N¬∞ 1</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>y</th><td style='padding:2px 0;'>-11.10017</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>x</th><td style='padding:2px 0;'>-77.59648</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>CondClimatica</th><td style='padding:2px 0;'>DESPEJADO</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>CausaFactorPrincipal</th><td style='padding:2px 0;'>IMPRUDENCIA DEL PEAT√ìN</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>CausaEspecifica</th><td style='padding:2px 0;'>CRUCE INDEBIDO POR LA CALZADA</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>OtraCausa</th><td style='padding:2px 0;'></td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>Observaciones</th><td style='padding:2px 0;'>NINGUNA</td></tr></table></div></div>`)[0];
                popup_932bcb7fdcac7ba73637dad9e54eadc2.setContent(html_ec01b284c06b36d8c1027c060e1882b7);
            
        

        circle_marker_bd1217255c33ab8694d57cda1e3fbf7d.bindPopup(popup_932bcb7fdcac7ba73637dad9e54eadc2)
        ;

        
    
    
            feature_group_d2fa571668b7ad39f8c1d28f3e727f6e.addTo(map_9c855c24086115ce7839a9bf9c450e97);
        
    
            map_9c855c24086115ce7839a9bf9c450e97.fitBounds(
                [[-11.103934, -77.616721], [-11.09862, -77.61245], [-11.09965, -77.60663], [-11.1013, -77.60759], [-11.095957, -77.603465], [-11.10154, -77.59812], [-11.10152, -77.59813], [-11.0954, -77.6034]],
                {}
            );
        
    
            var layer_control_94d8458a40945a92e2d54aeda1274a56_layers = {
                base_layers : {
                    "openstreetmap" : tile_layer_7a478678088da6db3c20b9e65f247c79,
                },
                overlays :  {
                    "contorno" : feature_group_c44904dfae7c11e72bce3e85c80af6ef,
                    "colegios: buffers" : feature_group_e7f534a8c55174cf4e5a24aa2d32764c,
                    "colegios: puntos" : feature_group_87eb84a6153bb3a567d0b95d709fb94e,
                    "siniestros fatales" : feature_group_d2fa571668b7ad39f8c1d28f3e727f6e,
                },
            };
            let layer_control_94d8458a40945a92e2d54aeda1274a56 = L.control.layers(
                layer_control_94d8458a40945a92e2d54aeda1274a56_layers.base_layers,
                layer_control_94d8458a40945a92e2d54aeda1274a56_layers.overlays,
                {
  "position": "topright",
  "collapsed": true,
  "autoZIndex": true,
}
            ).addTo(map_9c855c24086115ce7839a9bf9c450e97);

        
    
        feature_group_87eb84a6153bb3a567d0b95d709fb94e.bringToFront();
        feature_group_d2fa571668b7ad39f8c1d28f3e727f6e.bringToFront();
    
    
      (function() {
        var puntosLayer = feature_group_87eb84a6153bb3a567d0b95d709fb94e;
        var defaultTrue  = '#7dd3fc';
        var defaultFalse = '#1d4ed8';
        var hiliteColor  = '#f59e0b';

        // ---------- Toggle colapsar/expandir ----------
        var box = document.getElementById('zs_tools');
        var btnToggle = document.getElementById('btn_toggle_box');
        var saved = null;
        try { saved = localStorage.getItem('zs_tools_collapsed'); } catch(e) {}
        if (saved === '1') {
          box.classList.add('collapsed');
          btnToggle.textContent = '‚Øà Mostrar';
        }
        function toggleBox() {
          var collapsed = box.classList.toggle('collapsed');
          btnToggle.textContent = collapsed ? '‚Øà Mostrar' : '‚ØÜ Ocultar';
          try { localStorage.setItem('zs_tools_collapsed', collapsed ? '1' : '0'); } catch(e) {}
        }
        btnToggle.addEventListener('click', toggleBox);

        // ---------- Esperar a que el mapa est√© disponible ----------
        var ly_map = null;
        function ensureMap(cb) {
          var tries = 0;
          (function wait() {
            ly_map = (puntosLayer && puntosLayer._map) ? puntosLayer._map : null;
            if (ly_map) { cb(); return; }
            if (tries++ < 80) { setTimeout(wait, 50); }
          })();
        }

        ensureMap(function initTools() {
          // ---------- Utilidades de b√∫squeda ----------
          function eachMarker(fn) {
            if (!puntosLayer || !puntosLayer._layers) return;
            Object.values(puntosLayer._layers).forEach(function(ly) {
              if (ly && typeof ly.setStyle === 'function') fn(ly);
            });
          }

          function getTooltipText(ly) {
            try {
              var t = ly.getTooltip();
              return t ? String(t.getContent() || '').toLowerCase() : '';
            } catch(e) { return ''; }
          }

          function clearHighlights() {
            eachMarker(function(ly) {
              var st = (ly.options || {});
              if (!st._origColor) { st._origColor = st.color; }
              var orig = (st.color === hiliteColor) ? st._origColor : st.color;
              ly.setStyle({ color: orig || defaultFalse, fillColor: orig || defaultFalse });
            });
          }

          function searchAndHighlight() {
            var qn_raw = (document.getElementById('q_name').value || '');
            var qc_raw = (document.getElementById('q_code').value || '');
            var qn = qn_raw.toLowerCase();
            var qc = qc_raw.toLowerCase();

            var useName = qn_raw.trim().length > 0;
            var useCode = qc_raw.trim().length > 0;

            clearHighlights();
            if (!useName && !useCode) return;

            var matchedLatLngs = [];
            eachMarker(function(ly) {
              var txt = getTooltipText(ly);
              var parts = txt.split('|', 2);
              var nameTxt = (parts[0] || '').trim();
              var codeTxt = (parts[1] || '').trim();

              var matchName = useName ? (nameTxt.indexOf(qn) !== -1) : false;
              var matchCode = useCode ? (codeTxt.indexOf(qc) !== -1) : false;

              if (matchName || matchCode) {
                if (!ly.options._origColor) { ly.options._origColor = ly.options.color; }
                ly.setStyle({ color: hiliteColor, fillColor: hiliteColor });
                if (ly.getLatLng) matchedLatLngs.push(ly.getLatLng());
              }
            });

            if (matchedLatLngs.length > 0) {
              var group = L.featureGroup(matchedLatLngs.map(function(ll) { return L.marker(ll); }));
              try { ly_map.fitBounds(group.getBounds().pad(0.2)); } catch(e) {}
            }
          }

          document.getElementById('btn_search').addEventListener('click', searchAndHighlight);
          document.getElementById('btn_clear').addEventListener('click', function() {
            document.getElementById('q_name').value = '';
            document.getElementById('q_code').value = '';
            clearHighlights();
          });
          ['q_name','q_code'].forEach(function(id) {
            var el = document.getElementById(id);
            el.addEventListener('keydown', function(ev) { if (ev.key === 'Enter') searchAndHighlight(); });
          });

          // ---------- Pin por coordenadas ----------
          var coordLayer = L.layerGroup().addTo(ly_map);
          function goToXY() {
            var x = parseFloat((document.getElementById('q_x').value || '').replace(',', '.'));
            var y = parseFloat((document.getElementById('q_y').value || '').replace(',', '.'));
            if (!isFinite(x) || !isFinite(y)) return;
            coordLayer.clearLayers();
            var mk = L.marker([y, x], { draggable:false, title: 'Punto (Y,X): '+y+', '+x });
            mk.addTo(coordLayer);
            ly_map.setView([y, x], Math.max(ly_map.getZoom(), 17));
          }
          function clearXY() { coordLayer.clearLayers(); }
          document.getElementById('btn_xy_go').addEventListener('click', goToXY);
          document.getElementById('btn_xy_clear').addEventListener('click', clearXY);

          // ---------- Medici√≥n ----------
          var measuring = false;
          var mA = null, mB = null, mLine = null;

          function haversine(lat1, lon1, lat2, lon2) {
            var R = 6371000;
            var dLat = (lat2-lat1) * Math.PI/180;
            var dLon = (lon2-lon1) * Math.PI/180;
            var a = Math.sin(dLat/2)*Math.sin(dLat/2) +
                    Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180) *
                    Math.sin(dLon/2)*Math.sin(dLon/2);
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
          }

          function updateMeasure() {
            if (!(mA && mB)) return;
            var a = mA.getLatLng(), b = mB.getLatLng();
            var d = haversine(a.lat, a.lng, b.lat, b.lng);
            var txt = (d >= 1000) ? (d/1000).toFixed(3)+' km' : Math.round(d)+' m';

            if (!mLine) {
              mLine = L.polyline([a, b], { color: '#111827', weight: 3, dashArray: '6,4' })
                .bindTooltip(txt, { permanent:true, direction:'center', className:'dist-on-line' })
                .addTo(ly_map);
            } else {
              mLine.setLatLngs([a, b]);
              mLine.setTooltipContent(txt);
            }
          }

          function clearMeasure() {
            if (mA) ly_map.removeLayer(mA); mA = null;
            if (mB) ly_map.removeLayer(mB); mB = null;
            if (mLine) ly_map.removeLayer(mLine); mLine = null;
          }

          function toggleMeasure() {
            measuring = !measuring;
            var stateSpan = document.getElementById('measure_state');
            stateSpan.textContent = measuring ? 'Activo' : 'Desactivado';
            stateSpan.style.color = measuring ? '#065f46' : '#991b1b';
            if (!measuring) {
              clearMeasure();
              ly_map.getContainer().style.cursor = '';
              return;
            }
            ly_map.getContainer().style.cursor = 'crosshair';
          }
          document.getElementById('btn_measure_toggle').addEventListener('click', toggleMeasure);

          ly_map.on('click', function(ev) {
            if (!measuring) return;
            if (!mA) {
              mA = L.marker(ev.latlng, { draggable:true, title:'Punto A' }).addTo(ly_map);
              mA.on('drag', updateMeasure);
            } else if (!mB) {
              mB = L.marker(ev.latlng, { draggable:true, title:'Punto B' }).addTo(ly_map);
              mB.on('drag', updateMeasure);
            } else {
              mB.setLatLng(ev.latlng);
            }
            updateMeasure();
          });

          // ---------- Abrir vista actual en Google Maps ----------
          function openInGoogleMaps() {
            var c = ly_map.getCenter();
            var z = ly_map.getZoom();
            var url = 'https://www.google.com/maps/@' + c.lat + ',' + c.lng + ',' + z + 'z';
            window.open(url, '_blank');
          }
          document.getElementById('btn_open_gmaps').addEventListener('click', openInGoogleMaps);
        });
      })();
    
</script>
</html>