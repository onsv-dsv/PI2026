<!DOCTYPE html>
<html>
<head>
    
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css"/>
    
            <meta name="viewport" content="width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
            <style>
                #map_1c398762549445f4d114594c95cd404a {
                    position: relative;
                    width: 100.0%;
                    height: 100.0%;
                    left: 0.0%;
                    top: 0.0%;
                }
                .leaflet-container { font-size: 1rem; }
            </style>

            <style>html, body {
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }
            </style>

            <style>#map {
                position:absolute;
                top:0;
                bottom:0;
                right:0;
                left:0;
                }
            </style>

            <script>
                L_NO_TOUCH = false;
                L_DISABLE_3D = false;
            </script>

        
</head>
<body>
    
    
    <style>
      .leaflet-interactive.zs-buffer { pointer-events: none !important; }

      .searchbar-wrap {
        position: fixed; right: 20px; bottom: 140px;
        z-index: 10000; background: rgba(255,255,255,0.95);
        border: 1px solid #e5e7eb;
        padding: 10px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.12);
        font-family: system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;
        display: flex; flex-direction: column; gap: 8px; min-width: 300px; max-width: 92vw;
      }

      .searchbar-header { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
      .searchbar-title { font-weight: 700; font-size: 14px; color: #111827; }
      .toggle-btn { border: 0; border-radius: 8px; padding: 4px 10px; font-weight: 700; cursor: pointer; background: #111827; color: #fff; }
      .tools-body { display: flex; flex-direction: column; gap: 8px; }

      .row-flex { display:flex; gap:8px; align-items:center; }
      .col-flex { display:flex; flex-direction:column; gap:8px; }
      .row-flex input, .col-flex input { border:1px solid #e5e7eb; border-radius:8px; padding:6px 8px; font-size:13px; flex:1; }
      .row-flex button, .col-flex button { border:0; border-radius:8px; padding:6px 10px; font-weight:600; cursor:pointer; }
      .btn-dark  { background:#111827; color:#fff; }
      .btn-gray  { background:#6b7280; color:#fff; }
      .btn-green { background:#065f46; color:#fff; }
      .btn-red   { background:#991b1b; color:#fff; }
      .pill { font-size:12px; padding:4px 8px; border-radius:999px; }
      .dist-on-line { background: rgba(17,24,39,0.85); color: #fff; padding: 2px 6px; border-radius: 6px; font-size: 12px; border: 1px solid rgba(255,255,255,0.2); }

      .searchbar-wrap.collapsed { padding: 8px 10px; }
      .searchbar-wrap.collapsed .tools-body { display: none; }

      @media (max-width: 480px) {
        .searchbar-wrap { right: 12px; bottom: 12px; min-width: 240px; }
      }
    </style>
    
    
    <div style="
        position: fixed; top: 10px; left: 50%; transform: translateX(-50%);
        z-index: 9999; background: rgba(255,255,255,0.9);
        padding: 8px 14px; border-radius: 8px; font-weight: 600;
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;">
        AYACUCHO-LA_MAR-SANTA_ROSA
    </div>
    
    
    <div id="legend-box" style="
        position: fixed; bottom: 20px; right: 20px; z-index: 9999;
        background: rgba(255,255,255,0.9); padding: 10px 12px; border-radius: 8px;
        font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
        box-shadow: 0 2px 6px rgba(0,0,0,0.15); line-height: 1.4; min-width: 240px;">
        <div style="font-weight: 600; margin-bottom: 6px;">Leyenda</div>
        <div style="display:flex; align-items:center; gap:8px; margin-bottom:4px;">
            <span style="display:inline-block; width:14px; height:14px; background:#1d4ed8; border-radius:50%;"></span>
            <span>Azul: Intersecci√≥n priorizada</span>
        </div>
        <div style="display:flex; align-items:center; gap:8px;">
            <span style="display:inline-block; width:14px; height:14px; background:#d90429; border-radius:50%;"></span>
            <span>Rojo: Siniestro fatal</span>
        </div>
        <div style="display:flex; align-items:center; gap:8px; margin-top:6px;">
            <span style="display:inline-block; width:14px; height:14px; background:#f59e0b; border-radius:50%;"></span>
            <span>Amarillo: Coincidencia de b√∫squeda</span>
        </div>
    </div>
    
    
            <div class="folium-map" id="map_1c398762549445f4d114594c95cd404a" ></div>
        
    
      <div class="searchbar-wrap" id="zs_tools">
        <div class="searchbar-header">
          <div class="searchbar-title">Herramientas</div>
          <button id="btn_toggle_box" class="toggle-btn" title="Mostrar/Ocultar">‚ØÜ Ocultar</button>
        </div>

        <div class="tools-body">
          <div class="col-flex">
            <input id="q_name" type="text" placeholder="Buscar por nombre">
            <input id="q_code" type="text" placeholder="Buscar por c√≥digo">
          </div>
          <div class="row-flex">
            <button id="btn_search" class="btn-dark">Buscar</button>
            <button id="btn_clear" class="btn-gray">Limpiar</button>
          </div>

          <hr style="border:none;border-top:1px solid #e5e7eb; margin:4px 0;">

          <div class="col-flex" title="Coordenadas en grados decimales">
            <input id="q_x" type="text" placeholder="Longitud Ejem: -77.15435">
            <div class="row-flex">
              <input id="q_y" type="text" placeholder="Latitud Ejem: -15.54648">
              <button id="btn_xy_go" class="btn-green" title="Centrar en coordenadas">üîç</button>
              <button id="btn_xy_clear" class="btn-red"   title="Quitar pin de coordenadas">‚úï</button>
            </div>
          </div>

          <div class="row-flex">
            <button id="btn_measure_toggle" class="btn-dark pill" title="Medir distancia">Medir distancia</button>
            <span id="measure_state" style="font-size:12px; color:#991b1b">Desactivado</span>
          </div>

          <div class="row-flex">
            <button id="btn_open_gmaps" class="btn-dark" title="Abrir esta vista en Google Maps">Abrir en Google Maps</button>
          </div>
        </div>
      </div>
    
</body>
<script>
    
    
            var map_1c398762549445f4d114594c95cd404a = L.map(
                "map_1c398762549445f4d114594c95cd404a",
                {
                    center: [-12.70972, -73.72236145],
                    crs: L.CRS.EPSG3857,
                    ...{
  "zoom": 14,
  "zoomControl": true,
  "preferCanvas": false,
}

                }
            );
            L.control.scale().addTo(map_1c398762549445f4d114594c95cd404a);

            

        
    
            var tile_layer_1812605c955830150ee969969665645e = L.tileLayer(
                "https://tile.openstreetmap.org/{z}/{x}/{y}.png",
                {
  "minZoom": 0,
  "maxZoom": 19,
  "maxNativeZoom": 19,
  "noWrap": false,
  "attribution": "\u0026copy; \u003ca href=\"https://www.openstreetmap.org/copyright\"\u003eOpenStreetMap\u003c/a\u003e contributors",
  "subdomains": "abc",
  "detectRetina": false,
  "tms": false,
  "opacity": 1,
}

            );
        
    
            tile_layer_1812605c955830150ee969969665645e.addTo(map_1c398762549445f4d114594c95cd404a);
        
    
            var feature_group_4c9c0212b9c91b3980fe8879aec661cf = L.featureGroup(
                {
}
            );
        
    
        function geo_json_a15856ba06b4c44da0ad6d83a9b18018_styler(feature) {
            switch(feature.properties.IDDPTO) {
                default:
                    return {"color": "#222222", "fill": true, "fillColor": "#9ca3af", "fillOpacity": 0.3, "opacity": 1.0, "weight": 2.5};
            }
        }

        function geo_json_a15856ba06b4c44da0ad6d83a9b18018_onEachFeature(feature, layer) {

            layer.on({
            });
        };
        var geo_json_a15856ba06b4c44da0ad6d83a9b18018 = L.geoJson(null, {
                onEachFeature: geo_json_a15856ba06b4c44da0ad6d83a9b18018_onEachFeature,
            
                style: geo_json_a15856ba06b4c44da0ad6d83a9b18018_styler,
            ...{
}
        });

        function geo_json_a15856ba06b4c44da0ad6d83a9b18018_add (data) {
            geo_json_a15856ba06b4c44da0ad6d83a9b18018
                .addData(data);
        }
            geo_json_a15856ba06b4c44da0ad6d83a9b18018_add({"features": [{"geometry": {"coordinates": [[[[-73.72087110799998, -12.650333479999915], [-73.71985060799989, -12.652652729999886], [-73.71906210799995, -12.65436885499986], [-73.7185518579999, -12.65576047999997], [-73.71748510799995, -12.658543480999924], [-73.71627910799998, -12.660398855999972], [-73.71400623299996, -12.663506604999895], [-73.71210448299996, -12.665964979999899], [-73.71089848299994, -12.667263729999888], [-73.70992435799997, -12.667959604999908], [-73.70811535799999, -12.668748229999892], [-73.70496123299995, -12.669165605999979], [-73.70231735799996, -12.669258354999897], [-73.70106498299998, -12.669582979999973], [-73.70022998399998, -12.67023235499994], [-73.69939510799992, -12.670974480999973], [-73.69832823299993, -12.672134104999827], [-73.69758610799988, -12.673432854999817], [-73.69735423299988, -12.674638854999955], [-73.69744698299985, -12.675752105999948], [-73.69772523299997, -12.676679854999975], [-73.69800360799996, -12.677607479999892], [-73.69837460799994, -12.678813479999917], [-73.69842110799988, -12.679973104999874], [-73.69814285799987, -12.680947230999834], [-73.69758610799988, -12.682756229999939], [-73.69675123299999, -12.684425979999958], [-73.6947567339999, -12.686559604999957], [-73.69327235799994, -12.6877193549999], [-73.69229848299983, -12.688043979999918], [-73.6911851079999, -12.688090479999971], [-73.6901182339999, -12.688136729999883], [-73.68937610799998, -12.688368730999969], [-73.68826285799997, -12.688183104999894], [-73.68696410799998, -12.687580104999938], [-73.68543335799995, -12.686884354999904], [-73.68422735799993, -12.686930730999904], [-73.68343885799999, -12.687255479999976], [-73.68246485799995, -12.68781210499992], [-73.68190823299989, -12.688739730999941], [-73.68130523299999, -12.69008498099987], [-73.68098048299987, -12.691661979999878], [-73.6806094829999, -12.693424604999962], [-73.67986723299992, -12.695511854999836], [-73.67931060799998, -12.696578729999885], [-73.67875410799996, -12.697460105999937], [-73.67791910799997, -12.69861960499992], [-73.67662035799998, -12.69987185499997], [-73.67546073299997, -12.70126360599994], [-73.67416198299998, -12.702794229999938], [-73.6727241079999, -12.704000229999963], [-73.6702657329999, -12.705762854999875], [-73.66882773299994, -12.707339979999972], [-73.66606510799988, -12.710205730999974], [-73.66477260799996, -12.711659730999827], [-73.66380323299995, -12.71277047999996], [-73.66325798299988, -12.713638855999875], [-73.66303585799989, -12.71422460599996], [-73.66271273299998, -12.71513335599991], [-73.66234910799989, -12.716102729999932], [-73.66192510799993, -12.717112479999969], [-73.66133935799996, -12.718142479999926], [-73.66032960799998, -12.719556105999914], [-73.65936023299997, -12.720828354999924], [-73.65884148299995, -12.721309479999945], [-73.65796273299998, -12.721748855999977], [-73.6573768579999, -12.722151604999908], [-73.65671773299982, -12.722664230999953], [-73.6560953579999, -12.72346973099991], [-73.65591223299998, -12.72416548099983], [-73.65583898299985, -12.72504422999998], [-73.65623735799994, -12.72568060499998], [-73.65731998299998, -12.725839980999979], [-73.65789998299994, -12.726409980999904], [-73.65852998299994, -12.726519979999864], [-73.65861998299994, -12.726539980999917], [-73.65953998299983, -12.726369980999891], [-73.66026998299992, -12.726089980999973], [-73.66174998399998, -12.725079980999908], [-73.66201998299994, -12.724969980999958], [-73.66272998299996, -12.725009979999982], [-73.66330998399991, -12.725209979999931], [-73.66541998299988, -12.725379980999946], [-73.66619998299996, -12.725569980999865], [-73.66836998299988, -12.726569979999908], [-73.66955998299994, -12.727289979999966], [-73.67022998299996, -12.727899979999904], [-73.67117998299994, -12.72943998099987], [-73.67183998299993, -12.73024997999994], [-73.67356998399998, -12.731969980999963], [-73.67394998299983, -12.732219979999968], [-73.67672998299997, -12.733459979999964], [-73.6778399829999, -12.734099980999872], [-73.67847998299999, -12.734559979999915], [-73.67985998299997, -12.735209980999969], [-73.68231998299996, -12.735809979999885], [-73.68438998299996, -12.736539979999975], [-73.68541998299992, -12.7370199799999], [-73.68814998299996, -12.73797997999992], [-73.69210998299997, -12.73901997999991], [-73.69335998299988, -12.739639980999982], [-73.69400998299994, -12.740059979999899], [-73.69468998299999, -12.740679980999971], [-73.69488998299994, -12.740779979999957], [-73.69517998299995, -12.741169980999928], [-73.69574998299993, -12.742239979999965], [-73.69688998299995, -12.744969980999826], [-73.69920998299995, -12.74923998099996], [-73.69945998299994, -12.74994997999994], [-73.70026998299994, -12.751739980999957], [-73.70068998299996, -12.752839979999976], [-73.70075998299995, -12.754209979999871], [-73.70101998299998, -12.755589980999957], [-73.70128998299992, -12.756239979999975], [-73.70172998299995, -12.756889980999858], [-73.70236998299993, -12.757569979999971], [-73.70419998299991, -12.758739980999962], [-73.70490848399993, -12.759256230999881], [-73.70631098299998, -12.759980104999897], [-73.7080608579999, -12.76199248099988], [-73.70810460799999, -12.764267230999963], [-73.70736098299989, -12.767810854999823], [-73.70762335799992, -12.769210729999827], [-73.70814835799996, -12.77017310499997], [-73.70954823299996, -12.771266854999965], [-73.71025998299996, -12.771792979999873], [-73.7111076079999, -12.772412355999961], [-73.71249323299998, -12.773406730999909], [-73.71397660799988, -12.774303355999905], [-73.71542735899993, -12.775248730999976], [-73.71647060799984, -12.776031229999887], [-73.71788885799992, -12.777090730999873], [-73.71898098299988, -12.778313354999966], [-73.72000798299996, -12.780334729999879], [-73.72061110899995, -12.781614355999977], [-73.72147510799994, -12.783179229999973], [-73.72199673299991, -12.7840921049999], [-73.72250198399996, -12.784923355999979], [-73.72310510799997, -12.78528197999998], [-73.72429510799992, -12.785999230999892], [-73.72489498399983, -12.786797980999893], [-73.72528623299996, -12.787727229999973], [-73.72553073299986, -12.788379230999908], [-73.72593823299991, -12.789129104999972], [-73.72699785899994, -12.789927855999963], [-73.72737273399991, -12.790302730999883], [-73.72792698299997, -12.790661354999884], [-73.72853010899996, -12.79101997999993], [-73.72905173399994, -12.791525354999976], [-73.72924735899988, -12.792128479999974], [-73.72950823299988, -12.792878230999918], [-73.72967123299998, -12.793416229999934], [-73.73046998299998, -12.79413348099996], [-73.73161098299994, -12.795095229999959], [-73.73293135799997, -12.79626885599987], [-73.73343673299996, -12.796888355999897], [-73.73395835799994, -12.79754035499991], [-73.73434960799989, -12.798208729999885], [-73.73474073299991, -12.798616230999926], [-73.73514835799989, -12.799203104999947], [-73.73536023299994, -12.799806230999934], [-73.7358818589999, -12.800360480999927], [-73.73659910799995, -12.80117547999987], [-73.73682735799991, -12.801925355999913], [-73.73687623299998, -12.802952230999892], [-73.73692510799998, -12.803750980999894], [-73.73705548299995, -12.805022480999924], [-73.73723485799997, -12.806163604999938], [-73.73769123299996, -12.807288354999912], [-73.73790323299994, -12.807989230999908], [-73.73815585899996, -12.808779854999955], [-73.73854710799992, -12.809334104999891], [-73.73892198299995, -12.809871979999912], [-73.73919910799987, -12.810572980999893], [-73.73936210799985, -12.811453230999916], [-73.73934585799992, -12.81218673099994], [-73.73905235899997, -12.812757355999906], [-73.73853073399988, -12.81322998099995], [-73.73797648299995, -12.813833229999943], [-73.73789498299988, -12.814697105999926], [-73.73791135799996, -12.815984854999954], [-73.73840035799992, -12.817631355999936], [-73.73915023299998, -12.81893535599994], [-73.74011198299996, -12.81978298099989], [-73.74123673299988, -12.820679605999942], [-73.74192135799996, -12.821282729999893], [-73.74298098399987, -12.821836980999933], [-73.74330698299991, -12.821951105999972], [-73.74392635899994, -12.822162980999906], [-73.74495335799998, -12.82234222999989], [-73.74584985899992, -12.822603104999928], [-73.74666498299996, -12.82286385499998], [-73.74746373399995, -12.823303979999878], [-73.74795273299992, -12.823760479999919], [-73.74837660799989, -12.82455923099991], [-73.74844173299988, -12.824901479999937], [-73.74871885799996, -12.825325355999894], [-73.74922423299995, -12.825814355999967], [-73.74972948299995, -12.826124105999895], [-73.75059348299999, -12.82679248099987], [-73.75142485799995, -12.82744447999994], [-73.75202798299995, -12.828047605999927], [-73.75294085799999, -12.828944230999923], [-73.75390998299997, -12.829949980999913], [-73.75470998299988, -12.831089980999934], [-73.75505998299991, -12.832069979999915], [-73.75573998299996, -12.835989979999965], [-73.75576998299994, -12.837059979999879], [-73.75560998299994, -12.839089980999972], [-73.75567998299988, -12.840519979999897], [-73.75585998299994, -12.841219980999824], [-73.7560999829999, -12.841709979999962], [-73.75664998299993, -12.842419980999978], [-73.75676998299991, -12.84256998099994], [-73.75781998299993, -12.843439980999904], [-73.75835998299993, -12.843799980999961], [-73.75925998299988, -12.844169980999936], [-73.76179998399988, -12.844709980999937], [-73.76322998299997, -12.845639979999874], [-73.76383998399984, -12.845899980999889], [-73.76383998299991, -12.84590998099992], [-73.76420998299989, -12.846299979999856], [-73.7644299829999, -12.84674998099996], [-73.76503998299984, -12.847699980999948], [-73.76582998299983, -12.848439980999899], [-73.76708998299989, -12.849099980999881], [-73.76795998299986, -12.849269979999917], [-73.76920998299988, -12.84937998099997], [-73.77010998299994, -12.849749979999956], [-73.77113998299996, -12.850169980999965], [-73.77209998299992, -12.850289980999946], [-73.77312998299988, -12.850279980999915], [-73.77432560899996, -12.850152604999948], [-73.77436998399997, -12.85055998099989], [-73.77433998399988, -12.850949980999928], [-73.77439360799997, -12.851750354999979], [-73.77437085799994, -12.852373479999926], [-73.77447285799997, -12.853189354999927], [-73.77449998299988, -12.854639979999888], [-73.77485998299994, -12.856389979999904], [-73.77497998299998, -12.85665998099995], [-73.77565998399996, -12.857599980999908], [-73.77618998299994, -12.857959979999976], [-73.77691998299991, -12.85811997999997], [-73.77830810799992, -12.85791760599983], [-73.78185160799995, -12.8587568559999], [-73.78294735799994, -12.859849105999956], [-73.78578148299994, -12.86026310499983], [-73.78881273299993, -12.862850979999962], [-73.78992985799988, -12.864456480999934], [-73.7911291079999, -12.86584922999998], [-73.79228960899991, -12.866468229999953], [-73.79280698299993, -12.866618855999889], [-73.79306810799994, -12.866908354999964], [-73.79335823299988, -12.867633480999928], [-73.79355160799997, -12.868745605999834], [-73.79359998299998, -12.870051230999934], [-73.79374510799994, -12.871598730999892], [-73.79437360799994, -12.87493498099991], [-73.79509898299995, -12.877449480999928], [-73.79563085799998, -12.878803354999945], [-73.79577598299988, -12.880108855999879], [-73.79577598299988, -12.881511229999944], [-73.79582285899988, -12.882670230999906], [-73.79595760899991, -12.88408573099997], [-73.79612610799984, -12.884591229999955], [-73.79659798299997, -12.884759730999974], [-73.79703610799999, -12.884860855999875], [-73.79757535799985, -12.885096730999862], [-73.79818198299995, -12.885298980999892], [-73.79946260799994, -12.885534854999946], [-73.80067585899997, -12.88556860499989], [-73.80239473299997, -12.885265230999948], [-73.80350660899995, -12.885062980999976], [-73.8048884829999, -12.884658605999846], [-73.80613548299988, -12.883917230999941], [-73.80660723299991, -12.883479104999935], [-73.8070117339999, -12.883141979999948], [-73.80768573399996, -12.883040980999851], [-73.80832610799996, -12.883175729999891], [-73.80879785799988, -12.88337797999992], [-73.8092359829999, -12.883816105999927], [-73.80984260799994, -12.88449010599993], [-73.81038185899996, -12.884658605999846], [-73.81102223399989, -12.88462485499997], [-73.81166248399995, -12.884456354999884], [-73.81220173299988, -12.884287854999968], [-73.81290948299994, -12.883445354999935], [-73.81354973399993, -12.882198355999947], [-73.81371835799996, -12.880917729999965], [-73.81412273299992, -12.87832272999998], [-73.81429123299995, -12.876974730999905], [-73.81483048299998, -12.876233230999958], [-73.81574035799991, -12.875828855999885], [-73.81705473299996, -12.875154855999881], [-73.81774010899994, -12.874968855999953], [-73.81806560899986, -12.875188480999839], [-73.81880723299992, -12.875525480999897], [-73.82018898299987, -12.875424354999893], [-73.82126748299993, -12.875188479999906], [-73.82210985799998, -12.874817730999894], [-73.82254810799992, -12.874750355999822], [-73.82315460799992, -12.874615604999974], [-73.82376135799996, -12.874514354999917], [-73.82430060799999, -12.874682980999921], [-73.82457010799999, -12.87505373099998], [-73.82464035899994, -12.875397730999907], [-73.82558123299998, -12.875188480999839], [-73.82655860799991, -12.87488523099995], [-73.82753585799998, -12.874413355999934], [-73.82847948299997, -12.87394160599996], [-73.82938948299994, -12.872997855999927], [-73.83023198299992, -12.871784604999903], [-73.83056898399991, -12.871346480999932], [-73.83127673299998, -12.87121173099996], [-73.83201823299993, -12.871177980999903], [-73.83323148299996, -12.87134647999983], [-73.83427623299997, -12.871279104999928], [-73.83542198299995, -12.870942105999916], [-73.83646673299995, -12.870402729999967], [-73.83717448299996, -12.869661479999934], [-73.83751148399995, -12.869358229999875], [-73.83805073399998, -12.869256979999932], [-73.8385562339999, -12.86942560599988], [-73.83936510799987, -12.869762604999949], [-73.84007285799998, -12.870268229999965], [-73.84115123399994, -12.870739855999886], [-73.84246560799988, -12.871144355999888], [-73.84367885799992, -12.871953105999921], [-73.84421810799995, -12.872593480999967], [-73.84517660799992, -12.873281480999879], [-73.84520598299997, -12.874015480999958], [-73.84502698299997, -12.874649229999875], [-73.84533023299997, -12.875188480999839], [-73.8463076089999, -12.876064730999929], [-73.84688048299995, -12.876536480999903], [-73.84866673299996, -12.876536480999903], [-73.84994735799995, -12.8759299809999], [-73.8504232329999, -12.87572910599988], [-73.85163248299995, -12.874042605999875], [-73.85217160799988, -12.874076354999943], [-73.85321635799988, -12.874682980999921], [-73.85496885799995, -12.87505373099998], [-73.85584510899997, -12.87559285499998], [-73.85672135899983, -12.876469105999945], [-73.85728123399997, -12.877244729999973], [-73.85749210799992, -12.877595355999915], [-73.85837273299995, -12.877210604999902], [-73.85914785899996, -12.877176855999949], [-73.86019260899997, -12.877210605999892], [-73.86110260799995, -12.877379105999978], [-73.86164173399999, -12.877446480999879], [-73.86238323399994, -12.877547605999894], [-73.86278760799985, -12.877480230999936], [-73.86339423399994, -12.877311730999907], [-73.86420310799997, -12.876839854999957], [-73.86460748399998, -12.876300605999916], [-73.86524298399996, -12.875386855999977], [-73.86572485799996, -12.875704104999954], [-73.86627773299995, -12.876072730999965], [-73.86738360799995, -12.876763855999968], [-73.86862760799988, -12.877455104999967], [-73.86973348299989, -12.877593230999935], [-73.87171473299998, -12.877455104999967], [-73.87581548399999, -12.877362854999888], [-73.87770460799987, -12.877086480999935], [-73.88046923399997, -12.876902104999942], [-73.8828652339999, -12.877178604999926], [-73.8837314829999, -12.877325980999956], [-73.88414610899991, -12.877381355999887], [-73.88461610799999, -12.877325979999966], [-73.8852796079999, -12.877132480999933], [-73.88602598299997, -12.876662480999926], [-73.88648085799991, -12.876192230999948], [-73.88646835799995, -12.875833229999955], [-73.88663423299994, -12.87481023099997], [-73.88693848299994, -12.873953229999927], [-73.88713185799998, -12.873400355999934], [-73.88753435799998, -12.87274422999991], [-73.88863285799982, -12.870443355999953], [-73.88865235799994, -12.869446980999953], [-73.88843123299995, -12.868396480999877], [-73.88798885799991, -12.867705354999828], [-73.88768473299996, -12.866958855999883], [-73.88782310799996, -12.866350730999898], [-73.88807185799993, -12.865935980999893], [-73.88879060799991, -12.86488548099993], [-73.88961998299987, -12.86411135599991], [-73.89058760799998, -12.863226729999894], [-73.89145510799995, -12.862854980999941], [-73.89202510799993, -12.86231423099997], [-73.89271085799999, -12.861427105999951], [-73.89379448299997, -12.86173385499984], [-73.89534260799996, -12.86156798099995], [-73.89650373299992, -12.861208604999888], [-73.89799660799991, -12.860849230999918], [-73.89885385799988, -12.860444855999958], [-73.89947110799994, -12.860108355999898], [-73.90056985899992, -12.85998985599997], [-73.90135598299997, -12.859063229999947], [-73.90268335799993, -12.857883355999945], [-73.90415810799982, -12.856408605999945], [-73.90489548299996, -12.855449980999936], [-73.90533798299998, -12.854528104999929], [-73.90583798299997, -12.853869354999972], [-73.90603848299997, -12.853569480999965], [-73.90596485799989, -12.85301648099994], [-73.9055592329999, -12.852205355999956], [-73.90507985799997, -12.851246730999947], [-73.9046743589999, -12.850619854999877], [-73.90360498399997, -12.849513729999842], [-73.90305198299995, -12.848665729999937], [-73.90294135899995, -12.848296979999873], [-73.90297823399999, -12.846637855999916], [-73.9034207329999, -12.845531729999948], [-73.90397373399992, -12.844941854999945], [-73.90461735899999, -12.844244354999944], [-73.90482185799993, -12.843282605999946], [-73.90474823299996, -12.842545230999974], [-73.90460060799984, -12.841402230999961], [-73.90423185799995, -12.84040673099986], [-73.9035313579999, -12.839337480999916], [-73.90279398299992, -12.83837885599985], [-73.90194585799992, -12.837567729999876], [-73.9011912329999, -12.837090855999861], [-73.9002037329999, -12.836808729999973], [-73.89935735899996, -12.836498355999936], [-73.89839473399991, -12.83645185599994], [-73.89839798299988, -12.835764730999927], [-73.89808760799997, -12.835228730999972], [-73.89712835799992, -12.83469260499993], [-73.8968178579999, -12.834269355999822], [-73.89662048299994, -12.833705105999854], [-73.89661298399983, -12.833008605999964], [-73.89698710799996, -12.83229435499993], [-73.89704373299992, -12.83153260599994], [-73.89678973299988, -12.83105298099997], [-73.89628198399998, -12.830347605999975], [-73.89588698299997, -12.829698604999976], [-73.89581635799982, -12.829148480999947], [-73.89568098299998, -12.828651855999965], [-73.89502635899998, -12.827929604999895], [-73.89419123399989, -12.8271396049999], [-73.89337860799998, -12.826484980999908], [-73.8926337339999, -12.825536980999914], [-73.89231773399996, -12.824047230999952], [-73.8923403579999, -12.82337010599997], [-73.89254348299983, -12.822670354999957], [-73.89290460799987, -12.821835104999934], [-73.89301748299988, -12.821271104999937], [-73.89276923399996, -12.820300355999962], [-73.89222748299989, -12.819216855999969], [-73.89134723299998, -12.818336605999946], [-73.89057973299998, -12.817614480999964], [-73.89035398399994, -12.817298355999924], [-73.89030885799986, -12.816779230999941], [-73.89039923299987, -12.816395480999915], [-73.89089573299998, -12.81578598099992], [-73.89141485799996, -12.81515398099998], [-73.89143748399988, -12.814770230999898], [-73.89127948399994, -12.814273730999957], [-73.89091835799991, -12.813912604999928], [-73.89039923299987, -12.813528855999948], [-73.88967685899996, -12.813077355999894], [-73.88894735799983, -12.812362105999966], [-73.88860348299988, -12.811639980999928], [-73.88840110799993, -12.810425105999911], [-73.88832835799985, -12.80985185599991], [-73.88805335899991, -12.80923298099998], [-73.88712485799994, -12.807926230999954], [-73.8867466079999, -12.805691230999855], [-73.88709048399994, -12.804346730999896], [-73.88743435899994, -12.802833730999964], [-73.88777823299989, -12.801870855999937], [-73.88846598299995, -12.801114355999971], [-73.88949760799994, -12.80046110599983], [-73.89059785799998, -12.79980772999994], [-73.89106823299988, -12.798854354999946], [-73.89035723299986, -12.798466729999916], [-73.88960073299995, -12.79791647999997], [-73.8891536079999, -12.797366354999895], [-73.88887873399983, -12.796575479999944], [-73.88880985799989, -12.795750230999943], [-73.88911923299992, -12.794512230999942], [-73.88908485799993, -12.79303373099998], [-73.8888057339999, -12.79177760499988], [-73.88848523299987, -12.791065480999919], [-73.88787998299995, -12.790068605999977], [-73.88691860799992, -12.78875110599995], [-73.88620648299997, -12.787006480999935], [-73.88556560899997, -12.78611635599998], [-73.8849958589999, -12.785368604999917], [-73.88445773399997, -12.785107979999964], [-73.88338573399989, -12.784600229999967], [-73.88152398399995, -12.783923105999975], [-73.87949298299998, -12.782794729999978], [-73.87842098399989, -12.781835730999944], [-73.87751823299999, -12.780707355999823], [-73.87689773299996, -12.779578980999872], [-73.87588210899997, -12.77766072999998], [-73.87531798299995, -12.776024605999964], [-73.87497948299989, -12.77506547999991], [-73.87418960899998, -12.774332104999928], [-73.87323048299987, -12.773824355999977], [-73.87142510799998, -12.772752355999955], [-73.8706352339999, -12.772019105999846], [-73.86956335799994, -12.770269979999966], [-73.86882985799991, -12.769085229999916], [-73.86809648299999, -12.768351730999882], [-73.86708098399998, -12.767054105999932], [-73.86646035799998, -12.765982230999953], [-73.86606535799996, -12.764402479999887], [-73.86533473299994, -12.76255510599998], [-73.86466935899995, -12.760041480999917], [-73.8642257329999, -12.75745385499988], [-73.86374998299988, -12.756169105999959], [-73.86351810899998, -12.755036980999932], [-73.86348223399995, -12.753530730999898], [-73.86312360799991, -12.752813480999976], [-73.86229873399998, -12.75191685599998], [-73.86107935799998, -12.751199604999954], [-73.86025448299995, -12.750374730999908], [-73.85935785799984, -12.749406354999962], [-73.85838960899991, -12.748115230999929], [-73.85774385799988, -12.747397980999892], [-73.85720598299997, -12.747003605999964], [-73.85483898299998, -12.74578410599986], [-73.85325785799995, -12.74477148099993], [-73.85069335799994, -12.74060935599988], [-73.85119848399984, -12.736849104999976], [-73.85124760899998, -12.732357355999966], [-73.85032960799998, -12.730688480999959], [-73.84889260799991, -12.722392605999971], [-73.84844160799997, -12.717381854999871], [-73.84882898299998, -12.715682104999928], [-73.85009273299983, -12.712917729999901], [-73.84867110799996, -12.709521605999953], [-73.84551185799995, -12.705256604999931], [-73.84440610899998, -12.703440105999903], [-73.84211560899996, -12.701939355999968], [-73.8406149839999, -12.699332979999895], [-73.83958823299992, -12.69672660499998], [-73.83674485899996, -12.695068105999951], [-73.83516523299988, -12.69277760499989], [-73.83257123399994, -12.69081722999988], [-73.8305902329999, -12.688340980999897], [-73.82935623299994, -12.68651048099997], [-73.82639985799995, -12.684273479999888], [-73.82336410899995, -12.682116230999895], [-73.82072735799983, -12.680518355999936], [-73.81314635899997, -12.676899729999946], [-73.80844023299989, -12.674244980999958], [-73.80443948299995, -12.671298855999908], [-73.80198435899996, -12.670443980999949], [-73.79806260799984, -12.66881485499988], [-73.79444248299995, -12.667366855999887], [-73.78961560899984, -12.666461855999898], [-73.78551298399992, -12.665496480999877], [-73.78336010799995, -12.664789979999966], [-73.78244985899988, -12.66410998099991], [-73.78183998299994, -12.663729980999904], [-73.78120998399999, -12.663509979999901], [-73.78062810799997, -12.663357355999892], [-73.77969998299989, -12.663109979999945], [-73.77910260799996, -12.662861604999932], [-73.7778441079999, -12.662346729999854], [-73.77557523399997, -12.66135522999997], [-73.77376385799994, -12.660649854999974], [-73.77352998299995, -12.660569980999924], [-73.77151998299996, -12.659439979999945], [-73.77087998399998, -12.658949980999978], [-73.76861998299984, -12.656459980999955], [-73.76792998299993, -12.655529980999916], [-73.76705010899997, -12.654659979999963], [-73.7665899829999, -12.654349979999893], [-73.76625998299988, -12.654279980999945], [-73.76518998299997, -12.653869979999968], [-73.76469998299996, -12.653879979999886], [-73.7646554829999, -12.653548230999888], [-73.76466798299998, -12.653010105999954], [-73.76463048299996, -12.652572104999877], [-73.76003660799984, -12.649654729999895], [-73.75658785899992, -12.651462354999978], [-73.75342660799993, -12.65225260599982], [-73.75151673299985, -12.652516104999961], [-73.74881648299998, -12.652450230999932], [-73.74723573299991, -12.652450230999932], [-73.74341585899998, -12.65152822999994], [-73.74045223299998, -12.649025479999978], [-73.73865660899992, -12.647164104999945], [-73.73856585799996, -12.646665354999982], [-73.73849223299999, -12.64626035599997], [-73.73824573299993, -12.643959854999878], [-73.73795823299997, -12.64209060499985], [-73.73748573299991, -12.640693855999928], [-73.7369312329999, -12.640016104999972], [-73.73596573299994, -12.639153355999895], [-73.7338912329999, -12.638229104999823], [-73.73220685799998, -12.637530729999924], [-73.73076910799995, -12.636976104999974], [-73.72865348299996, -12.636709104999909], [-73.72692810799992, -12.63666798099996], [-73.7255518579999, -12.636647480999954], [-73.72503848299988, -12.636729604999914], [-73.72483298299994, -12.637058229999923], [-73.72483298299994, -12.637818229999937], [-73.72505885799995, -12.639481980999903], [-73.72536698399989, -12.640693855999928], [-73.72509998399994, -12.64217272999997], [-73.72429885799988, -12.644021480999982], [-73.72370073399998, -12.645416729999965], [-73.72258735799994, -12.647225729999889], [-73.72087110799998, -12.650333479999915]]]], "type": "MultiPolygon"}, "properties": {"AREA": 1, "CAPITAL": "SANTA ROSA", "CODCCPP": "0001", "DEPARTAMEN": "AYACUCHO", "DISTRITO": "SANTA ROSA", "FUENTE": "INEI", "IDDIST": "050507", "IDDPTO": "05", "IDPROV": "0505", "PROVINCIA": "LA MAR"}, "type": "Feature"}], "type": "FeatureCollection"});

        
    
            geo_json_a15856ba06b4c44da0ad6d83a9b18018.addTo(feature_group_4c9c0212b9c91b3980fe8879aec661cf);
        
    
            feature_group_4c9c0212b9c91b3980fe8879aec661cf.addTo(map_1c398762549445f4d114594c95cd404a);
        
    
            var feature_group_1e32ca27faeb0a5e71501a5080a04efa = L.featureGroup(
                {
}
            );
        
    
            var circle_85947767bf5cbf4c8f2279e96e308843 = L.circle(
                [-12.7095748, -73.722454],
                {"bubblingMouseEvents": true, "className": "zs-buffer", "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 0.5, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 50, "stroke": true, "weight": 2}
            ).addTo(feature_group_1e32ca27faeb0a5e71501a5080a04efa);
        
    
            var circle_9a8c7180964c2d24e9f84f990dd88275 = L.circle(
                [-12.7098652, -73.7222689],
                {"bubblingMouseEvents": true, "className": "zs-buffer", "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 0.5, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 50, "stroke": true, "weight": 2}
            ).addTo(feature_group_1e32ca27faeb0a5e71501a5080a04efa);
        
    
            feature_group_1e32ca27faeb0a5e71501a5080a04efa.addTo(map_1c398762549445f4d114594c95cd404a);
        
    
            var feature_group_b9ea2324ba53e1b6a359ff0851f96adc = L.featureGroup(
                {
}
            );
        
    
            var circle_marker_d8235cadaf6f657c1f760493b7b0d762 = L.circleMarker(
                [-12.7095748, -73.722454],
                {"bubblingMouseEvents": true, "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 1.0, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 5, "stroke": true, "weight": 2}
            ).addTo(feature_group_b9ea2324ba53e1b6a359ff0851f96adc);
        
    
        var popup_334fff4a711bd55b1eff20c7cde319ca = L.popup({
  "maxWidth": 460,
});

        
            
                var html_efae09b21b6abf02edd96b2db0748941 = $(`<div id="html_efae09b21b6abf02edd96b2db0748941" style="width: 100.0%; height: 100.0%;"><div style='font-size:12px;'><div style='font-weight:700; margin-bottom:6px;'>Intersecci√≥n priorizada</div><table style='border-collapse:collapse;'><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>id_int</th><td style='padding:2px 0;'>l-325755</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>latitud</th><td style='padding:2px 0;'>-12.7095748</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>longitud</th><td style='padding:2px 0;'>-73.722454</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>vias</th><td style='padding:2px 0;'>-</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>siniestro_fatal</th><td style='padding:2px 0;'>1</td></tr></table></div></div>`)[0];
                popup_334fff4a711bd55b1eff20c7cde319ca.setContent(html_efae09b21b6abf02edd96b2db0748941);
            
        

        circle_marker_d8235cadaf6f657c1f760493b7b0d762.bindPopup(popup_334fff4a711bd55b1eff20c7cde319ca)
        ;

        
    
    
            circle_marker_d8235cadaf6f657c1f760493b7b0d762.bindTooltip(
                `<div>
                      | 
                 </div>`,
                {
  "opacity": 0,
  "sticky": false,
}
            );
        
    
            var circle_marker_b13313ce06dd8ef5efef6e1714ec3d11 = L.circleMarker(
                [-12.7098652, -73.7222689],
                {"bubblingMouseEvents": true, "color": "#1d4ed8", "dashArray": null, "dashOffset": null, "fill": true, "fillColor": "#1d4ed8", "fillOpacity": 1.0, "fillRule": "evenodd", "lineCap": "round", "lineJoin": "round", "opacity": 1.0, "radius": 5, "stroke": true, "weight": 2}
            ).addTo(feature_group_b9ea2324ba53e1b6a359ff0851f96adc);
        
    
        var popup_6e385a4e5d4f15a4f3f6dee7ce68bfaa = L.popup({
  "maxWidth": 460,
});

        
            
                var html_7e81485907639589fc22fd424133b2fa = $(`<div id="html_7e81485907639589fc22fd424133b2fa" style="width: 100.0%; height: 100.0%;"><div style='font-size:12px;'><div style='font-weight:700; margin-bottom:6px;'>Intersecci√≥n priorizada</div><table style='border-collapse:collapse;'><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>id_int</th><td style='padding:2px 0;'>l-529001</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>latitud</th><td style='padding:2px 0;'>-12.7098652</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>longitud</th><td style='padding:2px 0;'>-73.7222689</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>vias</th><td style='padding:2px 0;'>-</td></tr><tr><th style='text-align:left; padding:2px 8px 2px 0; white-space:nowrap;'>siniestro_fatal</th><td style='padding:2px 0;'>1</td></tr></table></div></div>`)[0];
                popup_6e385a4e5d4f15a4f3f6dee7ce68bfaa.setContent(html_7e81485907639589fc22fd424133b2fa);
            
        

        circle_marker_b13313ce06dd8ef5efef6e1714ec3d11.bindPopup(popup_6e385a4e5d4f15a4f3f6dee7ce68bfaa)
        ;

        
    
    
            circle_marker_b13313ce06dd8ef5efef6e1714ec3d11.bindTooltip(
                `<div>
                      | 
                 </div>`,
                {
  "opacity": 0,
  "sticky": false,
}
            );
        
    
            feature_group_b9ea2324ba53e1b6a359ff0851f96adc.addTo(map_1c398762549445f4d114594c95cd404a);
        
    
            var feature_group_0d02a20770685ffe0ef239e39a29573f = L.featureGroup(
                {
}
            );
        
    
            feature_group_0d02a20770685ffe0ef239e39a29573f.addTo(map_1c398762549445f4d114594c95cd404a);
        
    
            map_1c398762549445f4d114594c95cd404a.fitBounds(
                [[-12.7095748, -73.722454], [-12.7098652, -73.7222689]],
                {}
            );
        
    
            var layer_control_639c74d29df61da642d046ea08aca4c5_layers = {
                base_layers : {
                    "openstreetmap" : tile_layer_1812605c955830150ee969969665645e,
                },
                overlays :  {
                    "contorno" : feature_group_4c9c0212b9c91b3980fe8879aec661cf,
                    "intersecciones: buffers (50m)" : feature_group_1e32ca27faeb0a5e71501a5080a04efa,
                    "intersecciones: puntos" : feature_group_b9ea2324ba53e1b6a359ff0851f96adc,
                    "siniestros fatales" : feature_group_0d02a20770685ffe0ef239e39a29573f,
                },
            };
            let layer_control_639c74d29df61da642d046ea08aca4c5 = L.control.layers(
                layer_control_639c74d29df61da642d046ea08aca4c5_layers.base_layers,
                layer_control_639c74d29df61da642d046ea08aca4c5_layers.overlays,
                {
  "position": "topright",
  "collapsed": true,
  "autoZIndex": true,
}
            ).addTo(map_1c398762549445f4d114594c95cd404a);

        
    
        feature_group_b9ea2324ba53e1b6a359ff0851f96adc.bringToFront();
        feature_group_0d02a20770685ffe0ef239e39a29573f.bringToFront();
    
    
      (function() {
        var puntosLayer = feature_group_b9ea2324ba53e1b6a359ff0851f96adc;
        var defaultColor = '#1d4ed8';
        var hiliteColor  = '#f59e0b';

        // ---------- Toggle colapsar/expandir ----------
        var box = document.getElementById('zs_tools');
        var btnToggle = document.getElementById('btn_toggle_box');
        var saved = null;
        try { saved = localStorage.getItem('zs_tools_collapsed'); } catch(e) {}
        if (saved === '1') {
          box.classList.add('collapsed');
          btnToggle.textContent = '‚Øà Mostrar';
        }
        function toggleBox() {
          var collapsed = box.classList.toggle('collapsed');
          btnToggle.textContent = collapsed ? '‚Øà Mostrar' : '‚ØÜ Ocultar';
          try { localStorage.setItem('zs_tools_collapsed', collapsed ? '1' : '0'); } catch(e) {}
        }
        btnToggle.addEventListener('click', toggleBox);

        // ---------- Esperar a que el mapa est√© disponible ----------
        var ly_map = null;
        function ensureMap(cb) {
          var tries = 0;
          (function wait() {
            ly_map = (puntosLayer && puntosLayer._map) ? puntosLayer._map : null;
            if (ly_map) { cb(); return; }
            if (tries++ < 80) { setTimeout(wait, 50); }
          })();
        }

        ensureMap(function initTools() {
          // ---------- Utilidades ----------
          function eachMarker(fn) {
            if (!puntosLayer || !puntosLayer._layers) return;
            Object.values(puntosLayer._layers).forEach(function(ly) {
              if (ly && typeof ly.setStyle === 'function') fn(ly);
            });
          }

          function getTooltipText(ly) {
            try {
              var t = ly.getTooltip();
              return t ? String(t.getContent() || '').toLowerCase() : '';
            } catch(e) { return ''; }
          }

          function clearHighlights() {
            eachMarker(function(ly) {
              ly.setStyle({ color: defaultColor, fillColor: defaultColor });
            });
          }

          // ---------- B√∫squeda ----------
          function searchAndHighlight() {
            var qn_raw = (document.getElementById('q_name').value || '');
            var qc_raw = (document.getElementById('q_code').value || '');
            var qn = qn_raw.toLowerCase();
            var qc = qc_raw.toLowerCase();

            var useName = qn_raw.trim().length > 0;
            var useCode = qc_raw.trim().length > 0;

            clearHighlights();
            if (!useName && !useCode) return;

            var matchedLatLngs = [];
            eachMarker(function(ly) {
              var txt = getTooltipText(ly); // "nombre | codigo"
              var parts = txt.split('|', 2);
              var nameTxt = (parts[0] || '').trim();
              var codeTxt = (parts[1] || '').trim();

              var matchName = useName ? (nameTxt.indexOf(qn) !== -1) : false;
              var matchCode = useCode ? (codeTxt.indexOf(qc) !== -1) : false;

              if (matchName || matchCode) {
                ly.setStyle({ color: hiliteColor, fillColor: hiliteColor });
                if (ly.getLatLng) matchedLatLngs.push(ly.getLatLng());
              }
            });

            if (matchedLatLngs.length > 0) {
              var group = L.featureGroup(matchedLatLngs.map(function(ll) { return L.marker(ll); }));
              try { ly_map.fitBounds(group.getBounds().pad(0.2)); } catch(e) {}
            }
          }

          document.getElementById('btn_search').addEventListener('click', searchAndHighlight);
          document.getElementById('btn_clear').addEventListener('click', function() {
            document.getElementById('q_name').value = '';
            document.getElementById('q_code').value = '';
            clearHighlights();
          });
          ['q_name','q_code'].forEach(function(id) {
            var el = document.getElementById(id);
            el.addEventListener('keydown', function(ev) { if (ev.key === 'Enter') searchAndHighlight(); });
          });

          // ---------- Pin por coordenadas ----------
          var coordLayer = L.layerGroup().addTo(ly_map);
          function goToXY() {
            var x = parseFloat((document.getElementById('q_x').value || '').replace(',', '.'));
            var y = parseFloat((document.getElementById('q_y').value || '').replace(',', '.'));
            if (!isFinite(x) || !isFinite(y)) return;
            coordLayer.clearLayers();
            var mk = L.marker([y, x], { draggable:false, title: 'Punto (Y,X): '+y+', '+x });
            mk.addTo(coordLayer);
            ly_map.setView([y, x], Math.max(ly_map.getZoom(), 17));
          }
          function clearXY() { coordLayer.clearLayers(); }
          document.getElementById('btn_xy_go').addEventListener('click', goToXY);
          document.getElementById('btn_xy_clear').addEventListener('click', clearXY);

          // ---------- Medici√≥n ----------
          var measuring = false;
          var mA = null, mB = null, mLine = null;

          function haversine(lat1, lon1, lat2, lon2) {
            var R = 6371000;
            var dLat = (lat2-lat1) * Math.PI/180;
            var dLon = (lon2-lon1) * Math.PI/180;
            var a = Math.sin(dLat/2)*Math.sin(dLat/2) +
                    Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180) *
                    Math.sin(dLon/2)*Math.sin(dLon/2);
            var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
          }

          function updateMeasure() {
            if (!(mA && mB)) return;
            var a = mA.getLatLng(), b = mB.getLatLng();
            var d = haversine(a.lat, a.lng, b.lat, b.lng);
            var txt = (d >= 1000) ? (d/1000).toFixed(3)+' km' : Math.round(d)+' m';

            if (!mLine) {
              mLine = L.polyline([a, b], { color: '#111827', weight: 3, dashArray: '6,4' })
                .bindTooltip(txt, { permanent:true, direction:'center', className:'dist-on-line' })
                .addTo(ly_map);
            } else {
              mLine.setLatLngs([a, b]);
              mLine.setTooltipContent(txt);
            }
          }

          function clearMeasure() {
            if (mA) ly_map.removeLayer(mA); mA = null;
            if (mB) ly_map.removeLayer(mB); mB = null;
            if (mLine) ly_map.removeLayer(mLine); mLine = null;
          }

          function toggleMeasure() {
            measuring = !measuring;
            var stateSpan = document.getElementById('measure_state');
            stateSpan.textContent = measuring ? 'Activo' : 'Desactivado';
            stateSpan.style.color = measuring ? '#065f46' : '#991b1b';
            if (!measuring) {
              clearMeasure();
              ly_map.getContainer().style.cursor = '';
              return;
            }
            ly_map.getContainer().style.cursor = 'crosshair';
          }

          document.getElementById('btn_measure_toggle').addEventListener('click', toggleMeasure);

          ly_map.on('click', function(ev) {
            if (!measuring) return;
            if (!mA) {
              mA = L.marker(ev.latlng, { draggable:true, title:'Punto A' }).addTo(ly_map);
              mA.on('drag', updateMeasure);
            } else if (!mB) {
              mB = L.marker(ev.latlng, { draggable:true, title:'Punto B' }).addTo(ly_map);
              mB.on('drag', updateMeasure);
            } else {
              mB.setLatLng(ev.latlng);
            }
            updateMeasure();
          });

          // ---------- Abrir vista actual en Google Maps ----------
          function openInGoogleMaps() {
            var c = ly_map.getCenter();
            var z = ly_map.getZoom();
            var url = 'https://www.google.com/maps/@' + c.lat + ',' + c.lng + ',' + z + 'z';
            window.open(url, '_blank');
          }
          document.getElementById('btn_open_gmaps').addEventListener('click', openInGoogleMaps);
        });
      })();
    
</script>
</html>